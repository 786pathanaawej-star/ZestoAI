import React, { useEffect } from 'react';
import { Routes, Route, useLocation } from 'react-router-dom';
import { AnimatePresence } from 'framer-motion';
import { useAuthStore } from './store/authStore';

import Layout from './components/Layout/Layout';
import LoadingSpinner from './components/UI/LoadingSpinner';
import ProtectedRoute from './components/ProtectedRoute';

import LandingPage from './pages/LandingPage';
import LoginPage from './pages/Auth/LoginPage';
import SignupPage from './pages/Auth/SignupPage';
import PersonalizationPage from './pages/PersonalizationPage';
import DashboardPage from './pages/DashboardPage';
import PantryPage from './pages/PantryPage';
import ChefPage from './pages/ChefPage';
// Import other pages as they are created
// import MealPlanPage from './pages/MealPlanPage';
// import RecipesPage from './pages/RecipesPage';
// import FamilyPage from './pages/FamilyPage';
// import ProfilePage from './pages/ProfilePage';
// import SettingsPage from './pages/SettingsPage';
// import SubscriptionPage from './pages/SubscriptionPage';

function App() {
  const { isLoading, initialize } = useAuthStore();
  const location = useLocation();

  useEffect(() => {
    initialize();
  }, [initialize]);

  if (isLoading) {
    return <LoadingSpinner />;
  }

  return (
    <AnimatePresence mode="wait">
      <Routes location={location} key={location.pathname}>
        {/* Public Routes */}
        <Route path="/" element={<LandingPage />} />
        
        {/* Auth Routes */}
        <Route path="/login" element={<LoginPage />} />
        <Route path="/signup" element={<SignupPage />} />

        {/* App Routes (Protected) */}
        <Route
          path="/*"
          element={
            <ProtectedRoute>
              <Layout>
                <Routes>
                  <Route path="/dashboard" element={<DashboardPage />} />
                  <Route path="/personalization" element={<PersonalizationPage />} />
                  <Route path="/pantry" element={<PantryPage />} />
                  <Route path="/chef" element={<ChefPage />} />
                  {/* <Route path="/meal-plan" element={<MealPlanPage />} /> */}
                  {/* <Route path="/recipes" element={<RecipesPage />} /> */}
                  {/* <Route path="/family" element={<FamilyPage />} /> */}
                  {/* <Route path="/profile" element={<ProfilePage />} /> */}
                  {/* <Route path="/settings" element={<SettingsPage />} /> */}
                  {/* <Route path="/subscription" element={<SubscriptionPage />} /> */}
                  <Route path="*" element={<DashboardPage />} /> {/* Fallback to dashboard */}
                </Routes>
              </Layout>
            </ProtectedRoute>
          }
        />
      </Routes>
    </AnimatePresence>
  );
}

export default App;
